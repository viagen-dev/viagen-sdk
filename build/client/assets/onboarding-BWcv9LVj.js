import{w as v,a as N,b as w,r as a,j as e}from"./chunk-JZWAC4HX-IldEFHxZ.js";import{c as b}from"./utils-C8nBGPD0.js";const x="viagen-onboarding-step",F=v(function({loaderData:r}){const s=N(),[n,c]=w(),{hasOrg:i,orgId:l}=r,u=()=>{const p=n.get("connected"),h=n.get("error");if(p==="vercel")return"done";if(h==="vercel"||p==="github")return"vercel";if(h==="github")return"github";if(i){if(typeof window<"u"){const m=localStorage.getItem(x);if(m==="github"||m==="vercel")return m}return"github"}return"team"},[t,d]=a.useState(u);a.useEffect(()=>{(n.has("connected")||n.has("error"))&&c({},{replace:!0})},[n,c]),a.useEffect(()=>{t!=="team"&&localStorage.setItem(x,t)},[t]);const f=()=>{localStorage.removeItem(x),s("/",{replace:!0})};a.useEffect(()=>{t==="done"&&f()},[t]);const y=async()=>{d("github")},j=async()=>{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),s("/login",{replace:!0})};return e.jsx("div",{className:"flex min-h-svh flex-col items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-[400px] p-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-center gap-2",children:[e.jsx(g,{active:t==="team",done:t!=="team",label:"1"}),e.jsx("div",{className:"h-px w-10 bg-border"}),e.jsx(g,{active:t==="github",done:t==="vercel",label:"2"}),e.jsx("div",{className:"h-px w-10 bg-border"}),e.jsx(g,{active:t==="vercel",done:!1,label:"3"})]}),t==="team"&&e.jsx(S,{onNext:y}),t==="github"&&e.jsx(k,{githubError:n.get("error")==="github",onSkip:()=>d("vercel")}),t==="vercel"&&e.jsx(C,{vercelError:n.get("error")==="vercel",onSkip:f}),e.jsx("button",{onClick:j,className:"mt-8 block w-full cursor-pointer border-none bg-transparent p-2 text-center text-xs text-muted-foreground hover:text-foreground",children:"Sign out"})]})})});function S({onNext:o}){const[r,s]=a.useState(""),[n,c]=a.useState(!1),[i,l]=a.useState(null),u=async()=>{if(r.trim()){c(!0),l(null);try{const t=await fetch("/api/orgs",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r.trim()})});if(!t.ok){const d=await t.json().catch(()=>null);l(d?.error??"Failed to create team");return}await o()}catch{l("Something went wrong")}finally{c(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-2 text-center text-2xl font-semibold",children:"Create your team"}),e.jsx("p",{className:"mb-8 text-center text-sm leading-relaxed text-muted-foreground",children:"Teams let you organize projects and collaborate with others."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-foreground/70",children:"Team name"}),e.jsx("input",{type:"text",placeholder:"Acme Inc.",value:r,onChange:t=>s(t.target.value),onKeyDown:t=>t.key==="Enter"&&u(),className:"w-full rounded-md border border-input bg-background px-3 py-2.5 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring",autoFocus:!0})]}),i&&e.jsx("p",{className:"mb-4 text-center text-[0.8125rem] text-destructive",children:i}),e.jsx("button",{onClick:u,disabled:n||!r.trim(),className:b("w-full cursor-pointer rounded-md bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground transition-opacity hover:bg-primary/90",(n||!r.trim())&&"cursor-not-allowed opacity-50"),children:n?"Creating...":"Continue"})]})}function k({githubError:o,onSkip:r}){return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-2 text-center text-2xl font-semibold",children:"Connect GitHub"}),e.jsx("p",{className:"mb-8 text-center text-sm leading-relaxed text-muted-foreground",children:"Link your GitHub account so viagen can access your repositories and save sandbox changes."}),o&&e.jsx("p",{className:"mb-4 text-center text-[0.8125rem] text-destructive",children:"Failed to connect GitHub. Please try again."}),e.jsx("a",{href:"/api/integrations/github/start",className:"flex w-full items-center justify-center gap-2 rounded-md bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground no-underline transition-opacity hover:bg-primary/90",children:"Connect GitHub"}),e.jsx("button",{onClick:r,className:"mt-4 block w-full cursor-pointer border-none bg-transparent p-2 text-center text-[0.8125rem] text-muted-foreground underline hover:text-foreground",children:"Skip for now"})]})}function C({vercelError:o,onSkip:r}){return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"mb-2 text-center text-2xl font-semibold",children:"Connect Vercel"}),e.jsx("p",{className:"mb-8 text-center text-sm leading-relaxed text-muted-foreground",children:"Link your Vercel account to deploy projects and manage environments."}),o&&e.jsx("p",{className:"mb-4 text-center text-[0.8125rem] text-destructive",children:"Failed to connect Vercel. Please try again."}),e.jsx("a",{href:"/api/integrations/vercel/start",className:"flex w-full items-center justify-center gap-2 rounded-md bg-primary px-5 py-2.5 text-sm font-medium text-primary-foreground no-underline transition-opacity hover:bg-primary/90",children:"Connect Vercel"}),e.jsx("button",{onClick:r,className:"mt-4 block w-full cursor-pointer border-none bg-transparent p-2 text-center text-[0.8125rem] text-muted-foreground underline hover:text-foreground",children:"Skip for now"})]})}function g({active:o,done:r,label:s}){return e.jsx("div",{className:b("flex h-7 w-7 items-center justify-center rounded-full text-xs font-semibold transition-all",o||r?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground"),children:r?"âœ“":s})}export{F as default};
